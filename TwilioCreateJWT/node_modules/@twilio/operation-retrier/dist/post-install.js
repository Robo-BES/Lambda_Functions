// Abort if the script is being run after "npm install" or "yarn" is executed on
// the monorepo project itself.
try {
  const monorepoPackageJson = require("../../../package.json");

  if (monorepoPackageJson.name === "root") {
    return;
  }
} catch {}

// Change the "browser" property to "./dist/react-native.js" if React Native
// is detected.
const fs = require("fs");

const mainProjectPackageJsonPath =
  require.main.paths[0].split("node_modules")[0] + "package.json";
const mainProjectPackageJson = require(mainProjectPackageJsonPath);
const dependencyPackageJsonPath = `${__dirname}/../package.json`;
const dependencyPackageJson = require(dependencyPackageJsonPath);

if (
  typeof mainProjectPackageJson?.dependencies?.["react-native"] !== "undefined"
) {
  dependencyPackageJson["browser"] = "./dist/react-native.js";
  fs.writeFileSync(
    dependencyPackageJsonPath,
    JSON.stringify(dependencyPackageJson, null, 2)
  );
}
